<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard GELP Final (Profesional)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
    <style>
        /* Variables de estilo (reconstruidas) */
        :root {
            --color-principal: #004c99;
            --color-sin-bono: #ff4d4d;
        }

        body { font-family: 'Roboto', Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; }
        .container { width: 95%; max-width: 1500px; margin: 25px auto; }
        .header { 
            background-color: var(--color-principal); 
            color: white; 
            padding: 30px; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); 
        }
        .header img { width: 70px; height: 70px; margin-right: 25px; filter: invert(100%); }
        .header h1 { margin: 0; font-size: 2.5em; }
        .header p { margin: 0; opacity: 0.8; font-size: 1.1em; }
        
        /* KPIs */
        .kpi-section { 
            display: flex; 
            justify-content: start; 
            gap: 40px; 
            margin: 30px 0;
            flex-wrap: wrap; /* Permite que los KPIs bajen de l칤nea si no caben */
        }
        .kpi-box { 
            background-color: white; 
            border-left: 6px solid var(--color-principal); 
            padding: 25px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); 
            width: 30%; /* Ajuste de ancho para 3 cajas en escritorio */
        }
        .kpi-box[style*="#ff4d4d"] { border-left-color: var(--color-sin-bono); }
        .kpi-box h4 { color: #555; margin: 0 0 10px 0; font-size: 1.1em; font-weight: 400; }
        .kpi-box p { font-size: 2.8em; font-weight: 700; color: var(--color-principal); margin: 0; }
        .kpi-box p[style*="#ff4d4d"] { color: var(--color-sin-bono); }
        
        /* Filtros */
        .filters { background-color: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        .filter-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 30px; 
            max-width: 600px; 
        }
        
        /* Gr치ficos */
        .chart-row { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: space-between; 
            margin-bottom: 30px; 
        }
        .chart-container { 
            background-color: white; 
            border-radius: 8px; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
            padding: 15px; 
            width: 49%; /* Dos gr치ficos por fila */
            box-sizing: border-box; 
            transition: transform 0.3s ease;
        }
        .chart-container:hover {
            transform: translateY(-3px);
        }

        /* 游댐 CORRECCI칍N 2: Media Query para Pantallas Peque침as (Responsive) */
        @media only screen and (max-width: 768px) {
            .header {
                flex-direction: column; /* Apilar logo y texto */
                text-align: center;
                padding: 20px 15px;
            }
            .header img {
                margin-right: 0;
                margin-bottom: 15px;
            }
            .header h1 {
                font-size: 1.6em;
            }

            .kpi-section {
                flex-direction: column; /* Apilar KPIs */
                gap: 20px;
            }
            .kpi-box {
                width: 100%; /* KPIs ocupan todo el ancho */
            }
            .kpi-box p {
                font-size: 2.2em; /* Reducir tama침o de letra del KPI */
            }

            .filter-grid {
                grid-template-columns: 1fr; /* Una columna para filtros */
            }

            .chart-row {
                flex-direction: column; /* Apilar gr치ficos */
                gap: 20px;
            }
            .chart-container {
                width: 100%; /* Gr치ficos ocupan todo el ancho */
                min-height: 400px; /* Asegurar una altura m칤nima visible */
            }
        }
    </style>
    
<script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
<script>
    // 丘멆잺 ATENCI칍N: JSON DE DATOS TRUNCADO EN EL C칍DIGO PROPORCIONADO. 
    // Por favor, reemplaza este snippet con tu JSON COMPLETO y ORIGINAL.
    var rawData = [{"Estado":"CONFIRMADO","Origen":"PROTOCOLO","Monto":0.0,"Tribuna":"CENTENARIO","Volumen":1,"TipoBono":"SIN BONO VOLUNTARIO"}, {"Estado":"CONFIRMADO","Origen":"CANJE","Monto":30000.0,"Tribuna":"FAVALORO","Volumen":1,"TipoBono":"BONO VOLUNTARIO"}];
    
    function updateDashboard() {
        var origen = document.getElementById('Origen').value;
        var tribuna = document.getElementById('Tribuna').value;
        
        var filteredData = rawData.filter(function(d) {
            var pass = true;
            if (origen !== 'TODOS' && d.Origen !== origen) pass = false;
            if (tribuna !== 'TODOS' && d.Tribuna !== tribuna) pass = false;
            return pass;
        });
        
        var newTotalMonto = filteredData.reduce((acc, d) => acc + d.Monto, 0);
        var newTotalVolumen = filteredData.length;
        
        var newSinBonoVolumen = filteredData.filter(d => d.TipoBono === 'SIN BONO VOLUNTARIO').length;
        var newSinBonoPct = newTotalVolumen > 0 ? ((newSinBonoVolumen / newTotalVolumen) * 100).toFixed(1) : 0;
        
        // 5. Actualizar KPIs en el HTML
        document.getElementById('kpi-monto').innerText = '$' + newTotalMonto.toLocaleString('es-AR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        document.getElementById('kpi-volumen').innerText = newTotalVolumen.toLocaleString('es-AR');
        document.getElementById('kpi-sin-bono').innerHTML = newSinBonoVolumen.toLocaleString('es-AR') + ' <span style="font-size: 0.5em; opacity: 0.7;">(' + newSinBonoPct + '%)</span>';


        // --- Gr치fico 1 (Volumen por Tribuna) ---
        var tribunaVolumen = filteredData.reduce((acc, d) => { acc[d.Tribuna] = (acc[d.Tribuna] || 0) + 1; return acc; }, {});
        var tribunas = Object.keys(tribunaVolumen);
        var volumenes = Object.values(tribunaVolumen);
        var totalTribunaVolumen = volumenes.reduce((sum, v) => sum + v, 0);
        var porcentajes = volumenes.map(v => ((v / totalTribunaVolumen) * 100).toFixed(1) + '%');
        
        var data2 = [{
            x: tribunas,
            y: volumenes,
            text: porcentajes,
            textposition: 'outside',
            type: 'bar', 
            marker: { 
                color: '#004c99',
                line: { width: 0 },
            },
            opacity: 0.9 
        }];
        
        var layout2 = {
            title: '1. Volumen de Tickets Confirmados por Tribuna (Distribuci칩n %)',
            plot_bgcolor: 'white', 
            paper_bgcolor: 'white', 
            font: {color: '#333', family: 'Roboto, Arial', size: 13},
            margin: {t: 50, b: 50, l: 40, r: 40}
        };
        Plotly.newPlot('chart2', data2, layout2);


        // --- Gr치fico 2 (An치lisis de Bono, Volumen Apilado CON ETIQUETAS Y PORCENTAJES) ---
        var aggregatedData = filteredData.reduce((acc, d) => {
            var key = d.Tribuna + '_' + d.TipoBono;
            acc[key] = (acc[key] || {Tribuna: d.Tribuna, TipoBono: d.TipoBono, Volumen: 0})
            acc[key].Volumen += 1;
            return acc;
        }, {});

        var finalData = Object.values(aggregatedData);
        var color_bono = '#5C82A8'; 
        var color_sin_bono = '#CCCCCC'; 

        var totalPorTribuna = finalData.reduce((acc, d) => {
            acc[d.Tribuna] = (acc[d.Tribuna] || 0) + d.Volumen;
            return acc;
        }, {});
        
        function getText(dataArray) {
            return dataArray.map(d => {
                var total = totalPorTribuna[d.Tribuna];
                var pct = ((d.Volumen / total) * 100).toFixed(1);
                return d.Volumen.toLocaleString('es-AR') + ' (' + pct + '%)'; 
            });
        }
        
        var traces = [
             { 
                x: finalData.filter(d => d.TipoBono === 'BONO VOLUNTARIO').map(d => d.Tribuna), 
                y: finalData.filter(d => d.TipoBono === 'BONO VOLUNTARIO').map(d => d.Volumen), 
                text: getText(finalData.filter(d => d.TipoBono === 'BONO VOLUNTARIO')),
                textposition: 'inside', 
                name: 'BONO VOLUNTARIO', 
                type: 'bar', 
                marker: { color: color_bono, line: { width: 0.5, color: 'white' } },
                opacity: 0.9
            },
             { 
                x: finalData.filter(d => d.TipoBono === 'SIN BONO VOLUNTARIO').map(d => d.Tribuna), 
                y: finalData.filter(d => d.TipoBono === 'SIN BONO VOLUNTARIO').map(d => d.Volumen), 
                text: getText(finalData.filter(d => d.TipoBono === 'SIN BONO VOLUNTARIO')),
                textposition: 'inside', 
                name: 'SIN BONO VOLUNTARIO', 
                type: 'bar', 
                marker: { color: color_sin_bono, line: { width: 0.5, color: 'white' } },
                opacity: 0.9
            }
        ];
        
        var layout3 = {
            title: '2. Cantidad de Tickets: Desglose por Tribuna y Bono Voluntario',
            barmode: 'stack',
            yaxis: { title: 'Cantidad de Gente (Volumen)' },
            plot_bgcolor: 'white', 
            paper_bgcolor: 'white', 
            font: {color: '#333', family: 'Roboto, Arial', size: 13},
            margin: {t: 50, b: 50, l: 40, r: 40},
            hovermode: 'closest'
        };
        Plotly.newPlot('chart3', traces, layout3);
    }
    
    window.onload = function() { updateDashboard(); };
</script>

</head>
<body>
<div class="container">
    <div class="header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/e4/Escudo_del_Club_de_Gimnasia_y_Esgrima_La_Plata.svg" alt="Logo GELP">
        <div>
            <h1>CLUB GIMNASIA Y ESGRIMA LA PLATA</h1>
            <p>Dashboard Din치mico: An치lisis de Venta de Tickets (CONFIRMADOS)</p>
        </div>
    </div>
    
    <div class="filters">
        <h3>丘뙖잺 Controles de Filtro Din치micos</h3>
        <div class="filter-grid">
            
        <div>
            <label for="Origen" style="font-weight: bold; color: #004c99;">Origen</label>
            <select id="Origen" onchange="updateDashboard()" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 100%;">
                <option value="TODOS">TODOS</option>
                <option value="CANJE">CANJE</option>
<option value="PACK">PACK</option>
<option value="PROTOCOLO">PROTOCOLO</option>
            </select>
        </div>
    
        <div>
            <label for="Tribuna" style="font-weight: bold; color: #004c99;">Tribuna</label>
            <select id="Tribuna" onchange="updateDashboard()" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 100%;">
                <option value="TODOS">TODOS</option>
                <option value="AVENIDA 60">AVENIDA 60</option>
<option value="BASILE">BASILE</option>
<option value="CENTENARIO">CENTENARIO</option>
<option value="FAVALORO">FAVALORO</option>
<option value="OTROS/GENERALES">OTROS/GENERALES</option>
            </select>
        </div>
        </div>
    </div>

    <div class="kpi-section">
        <div class="kpi-box">
            <h4>INGRESO TOTAL NETO (FILTRADO)</h4>
            <p id="kpi-monto">$0.00</p>
        </div>
        <div class="kpi-box">
            <h4>VOLUMEN TOTAL DE TICKETS</h4>
            <p id="kpi-volumen">2</p>
        </div>
        <div class="kpi-box" style="border-left: 6px solid #ff4d4d;"> 
            <h4>VOLUMEN SIN BONO VOLUNTARIO</h4>
            <p id="kpi-sin-bono" style="color: #ff4d4d;">1 <span style="font-size: 0.5em; opacity: 0.7;">(50.0%)</span></p>
        </div>
    </div>

    <div class="chart-row">
        <div id="chart2" class="chart-container" style="height: 500px;"></div> 
        <div id="chart3" class="chart-container" style="height: 500px;"></div>
    </div>
    
</div>
</body>
</html>
